# Requirements Archive: v1.1 Enterprise API Integration

**Archived:** 2026-02-20
**Status:** SHIPPED

This is the archived requirements specification for v1.1.
For current requirements, see `.planning/REQUIREMENTS.md` (created for next milestone).

---

## Milestone Requirements

### Authentication (AUTH)

- [x] **AUTH-01**: System acquires JWT tokens via OAuth2 client credentials grant from MMC Access Management API
- [x] **AUTH-02**: Token refresh happens proactively (5-min margin before expiry) so pipeline never hits mid-request expiry
- [x] **AUTH-03**: All API interactions (token requests, news fetches, equity lookups, email sends) are logged to an api_events table for observability
- [x] **AUTH-04**: When authentication fails, pipeline logs the failure and skips enterprise features gracefully (no silent crashes)

### Factiva News Collection (FACT)

- [x] **FACT-01**: Pipeline collects news via MMC Core API Recent News (Factiva/Dow Jones) endpoint using X-Api-Key authentication
- [x] **FACT-02**: Factiva queries use Brazilian insurance industry codes and Portuguese keywords to fetch relevant articles in batch
- [x] **FACT-03**: Individual article bodies are fetched from Factiva for full-text content (not just headlines)
- [x] **FACT-04**: AI-assisted matching assigns each Factiva article to one or more of the 897 tracked insurers using insurer names, search_terms, and Azure OpenAI for ambiguous cases
- [x] **FACT-05**: Factiva articles are normalized to BrasilIntel's NewsItem schema (title, description, source_url, source_name, published_at, insurer_id)
- [x] **FACT-06**: Factiva replaces all 6 Apify/RSS sources as the sole news collection mechanism — no fallback path
- [x] **FACT-07**: Duplicate articles are detected and filtered (URL dedup + semantic dedup within batch)

### Equity Price Enrichment (EQTY)

- [x] **EQTY-01**: Equity price data is retrieved via MMC Core API Equity Price endpoint for tracked Brazilian insurance companies
- [x] **EQTY-02**: Admin can configure entity-to-ticker mappings (insurer name to B3 stock ticker) via the admin dashboard
- [x] **EQTY-03**: Browser reports display inline equity chips (ticker, price, change%) alongside relevant insurer news
- [x] **EQTY-04**: Email reports display inline equity data in table-based layout compatible with Outlook and Gmail

### Enterprise Email Delivery (EEML) — REMOVED

- [ ] ~~**EEML-01**: Reports are delivered via MMC Core API Email endpoint as the primary delivery method~~
- [ ] ~~**EEML-02**: Enterprise email uses JWT Bearer + X-Api-Key authentication (tokens from AUTH-01)~~
- [ ] ~~**EEML-03**: When enterprise email fails for a category, delivery falls back to existing Graph API email automatically~~
- [ ] ~~**EEML-04**: PDF attachments are included in enterprise email delivery (matching current Graph API behavior)~~
- [ ] ~~**EEML-05**: Run record tracks which delivery method succeeded (enterprise, Graph fallback, or failed)~~

**Removal rationale:** Graph API email delivery is sufficient for current needs. Enterprise email via MMC Core API deferred to future milestone if Graph API proves inadequate.

### Admin Dashboard Extensions (ADMN)

- [x] **ADMN-17**: Dashboard shows enterprise API health panel (auth status, API connectivity, last success/failure times)
- [x] **ADMN-18**: Admin can configure MMC Core API credentials (API key, client ID, client secret) via settings UI
- [x] **ADMN-19**: Admin can configure Factiva query parameters (industry codes, keywords, date range) via dedicated page
- [x] **ADMN-20**: Admin can manage equity ticker mappings (insurer to B3 ticker CRUD) via dedicated page
- [x] **ADMN-21**: Dashboard shows fallback event log (enterprise to Graph fallback history with timestamps and reasons)
- [x] **ADMN-22**: Article listings show source badge indicating Factiva attribution

### Cleanup (CLNP)

- [x] **CLNP-01**: All 6 Apify scraper source classes and base class are removed from codebase
- [x] **CLNP-02**: apify-client and feedparser dependencies are removed from requirements.txt
- [x] **CLNP-03**: Pipeline collection step uses Factiva-only path (no fallback branching)
- [x] **CLNP-04**: .env.example is updated with MMC Core API configuration variables (replacing APIFY_TOKEN)

## Traceability

| Requirement | Phase | Plan | Status |
|-------------|-------|------|--------|
| AUTH-01 | Phase 9 | 09-03 | Complete |
| AUTH-02 | Phase 9 | 09-03 | Complete |
| AUTH-03 | Phase 9 | 09-01, 09-02, 09-03 | Complete |
| AUTH-04 | Phase 9 | 09-03 | Complete |
| FACT-01 | Phase 10 | 10-01 | Complete |
| FACT-02 | Phase 10 | 10-01 | Complete |
| FACT-03 | Phase 10 | 10-01 | Complete |
| FACT-04 | Phase 11 | 11-01, 11-02 | Complete |
| FACT-05 | Phase 10 | 10-01 | Complete |
| FACT-06 | Phase 11 | 11-03 | Complete |
| FACT-07 | Phase 10 | 10-02, 10-03 | Complete |
| EQTY-01 | Phase 12 | 12-01 | Complete |
| EQTY-02 | Phase 12 | 12-02 | Complete |
| EQTY-03 | Phase 12 | 12-03 | Complete |
| EQTY-04 | Phase 12 | 12-03 | Complete |
| EEML-01 | -- | -- | Removed (Graph API retained) |
| EEML-02 | -- | -- | Removed (Graph API retained) |
| EEML-03 | -- | -- | Removed (Graph API retained) |
| EEML-04 | -- | -- | Removed (Graph API retained) |
| EEML-05 | -- | -- | Removed (Graph API retained) |
| ADMN-17 | Phase 13 | 13-01 | Complete |
| ADMN-18 | Phase 13 | 13-02 | Complete |
| ADMN-19 | Phase 13 | 13-02 | Complete |
| ADMN-20 | Phase 12 | 12-02 | Complete |
| ADMN-21 | Phase 13 | 13-01 | Complete |
| ADMN-22 | Phase 13 | 13-03 | Complete |
| CLNP-01 | Phase 14 | 14-01 | Complete |
| CLNP-02 | Phase 14 | 14-01 | Complete |
| CLNP-03 | Phase 14 | 14-02 | Complete |
| CLNP-04 | Phase 14 | 14-02 | Complete |

## Future Requirements

- Historical equity price trends (charts over time) — deferred to v2
- Multi-language Factiva queries (English + Portuguese) — evaluate after v1.1 usage data
- Real-time Factiva streaming — daily batch sufficient for current audience
- Enterprise email delivery via MMC Core API — deferred, Graph API sufficient

## Out of Scope

- Apify/RSS fallback for news collection — Factiva is strict/sole source per user decision
- Direct Factiva API access (bypassing MMC Core API) — must use corporate Apigee gateway
- Per-insurer Factiva queries — batch query with post-hoc insurer matching is more efficient
- Editable recipients via UI — remains env var config (unchanged from v1.0)

---

## Milestone Summary

**Shipped:** 22 of 27 requirements (5 EEML requirements intentionally removed)
**Adjusted:** EEML-01 through EEML-05 removed — Graph API email delivery retained as sufficient
**Dropped:** None (all shipped requirements delivered as specified)

---
*Archived: 2026-02-20 as part of v1.1 milestone completion*
