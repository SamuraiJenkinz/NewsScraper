---
phase: 09-enterprise-api-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/config.py
  - .env.example
  - requirements.txt
autonomous: true

must_haves:
  truths:
    - "Settings object exposes mmc_api_base_url, mmc_api_client_id, mmc_api_client_secret, mmc_api_key, mmc_api_token_path fields"
    - "is_mmc_auth_configured() returns True only when base_url, client_id, and client_secret are all non-empty"
    - "is_mmc_api_key_configured() returns True only when base_url and api_key are both non-empty"
    - "tenacity is listed in requirements.txt"
    - ".env.example contains the MMC Core API section with all required variable names"
  artifacts:
    - path: "app/config.py"
      provides: "MMC Core API credential fields and configuration helper methods"
      contains: "mmc_api_base_url"
    - path: "requirements.txt"
      provides: "tenacity dependency for retry support"
      contains: "tenacity"
    - path: ".env.example"
      provides: "MMC Core API environment variable documentation"
      contains: "MMC_API_BASE_URL"
  key_links:
    - from: "app/config.py"
      to: "pydantic_settings.BaseSettings"
      via: "Settings class inheritance"
      pattern: "class Settings\\(BaseSettings\\)"
---

<objective>
Expand BrasilIntel's Settings class with MMC Core API credential fields and helper methods, add tenacity to requirements.txt, and document new environment variables in .env.example.

Purpose: Phases 10-13 all depend on MMC Core API credentials being available through the Settings object. This plan creates the configuration foundation that TokenManager (Plan 09-03) reads from.

Output: Updated config.py with 8 new fields and 3 helper methods, tenacity in requirements.txt, MMC section in .env.example.
</objective>

<execution_context>
@C:\Users\taylo\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\taylo\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@C:\BrasilIntel\.planning\ROADMAP.md
@C:\BrasilIntel\.planning\STATE.md
@C:\BrasilIntel\.planning\phases\09-enterprise-api-foundation\09-CONTEXT.md
@C:\BrasilIntel\.planning\phases\09-enterprise-api-foundation\09-RESEARCH.md

Source reference (what to port FROM):
@C:\BrasilIntel\mdinsights\app\config.py (lines 73-140 — mmc_* fields and helper methods)

Target files (what to modify):
@C:\BrasilIntel\app\config.py
@C:\BrasilIntel\requirements.txt
@C:\BrasilIntel\.env.example
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add MMC Core API fields and helpers to Settings class</name>
  <files>app/config.py</files>
  <action>
Add the following fields to the Settings class in app/config.py, AFTER the existing "Scheduler settings" block (before the `_parse_recipient_list` method):

```python
# MMC Core API (Enterprise Integration — Phase 9+)
# Used for Factiva news (X-Api-Key), equity prices (X-Api-Key),
# and enterprise email delivery (JWT Bearer + X-Api-Key)
mmc_api_base_url: str = ""
mmc_api_client_id: str = ""
mmc_api_client_secret: str = ""
mmc_api_key: str = ""
mmc_api_token_path: str = "/coreapi/access-management/v1/token"

# Enterprise Email Sender (Phase 13 — added now for completeness)
mmc_sender_email: str = ""    # Enterprise mailbox to send from
mmc_sender_name: str = ""     # Display name (set via MMC_SENDER_NAME env var)
mmc_email_path: str = "/coreapi/email/v1"
```

NOTE: `mmc_sender_name` defaults to empty string (not "Kevin Taylor" like MDInsights — BrasilIntel sender identity TBD in Phase 13).

Add these three helper methods to the Settings class, AFTER the existing `get_schedule_config` method:

```python
def is_mmc_auth_configured(self) -> bool:
    """Check if MMC Core API OAuth2 (JWT) auth is fully configured.

    Required for the Email API (Phase 13) which uses Bearer + X-Api-Key.
    """
    return bool(
        self.mmc_api_base_url
        and self.mmc_api_client_id
        and self.mmc_api_client_secret
    )

def is_mmc_api_key_configured(self) -> bool:
    """Check if MMC Core API X-Api-Key is configured.

    Required for Factiva news (Phase 10) and equity prices (Phase 12)
    which use X-Api-Key only (no JWT needed).
    """
    return bool(self.mmc_api_base_url and self.mmc_api_key)

def is_mmc_email_configured(self) -> bool:
    """Check if enterprise email delivery is fully configured.

    Requires JWT auth (mmc_auth) + API key + enterprise sender email.
    When False, pipeline uses Graph API for email delivery.
    """
    return bool(
        self.is_mmc_auth_configured()
        and self.mmc_api_key
        and self.mmc_sender_email
    )
```

Do NOT change any existing fields or methods. Only ADD the new fields and methods.
  </action>
  <verify>
Run `python -c "from app.config import get_settings; s = get_settings(); print(s.mmc_api_base_url); print(s.mmc_api_token_path); print(s.is_mmc_auth_configured()); print(s.is_mmc_api_key_configured()); print(s.is_mmc_email_configured())"` from project root. Should print empty string, `/coreapi/access-management/v1/token`, `False`, `False`, `False`.
  </verify>
  <done>Settings class has all 8 mmc_* fields with correct defaults and all 3 is_mmc_*_configured() helper methods returning False when unconfigured.</done>
</task>

<task type="auto">
  <name>Task 2: Add tenacity to requirements.txt and MMC section to .env.example</name>
  <files>requirements.txt, .env.example</files>
  <action>
1. In `requirements.txt`, add a new section AFTER the existing "Phase 7" block at the end:

```
# Phase 9 - Enterprise API Foundation
tenacity>=8.0.0
```

2. In `.env.example`, add a new section AFTER the existing "Scheduler Settings" section and BEFORE any trailing content:

```
# ============================================
# MMC Core API Configuration (Enterprise)
# ============================================
# Base URL for MMC Core API (Apigee gateway)
# Staging: https://mmc-dallas-int-non-prod-ingress.mgti.mmc.com
# MMC_API_BASE_URL=https://mmc-dallas-int-non-prod-ingress.mgti.mmc.com

# OAuth2 client credentials (from Apigee portal)
# MMC_API_CLIENT_ID=your-client-id
# MMC_API_CLIENT_SECRET=your-client-secret

# X-Api-Key for data endpoints (Factiva, Equity)
# MMC_API_KEY=your-api-key

# Token endpoint path (usually no need to change)
# MMC_API_TOKEN_PATH=/coreapi/access-management/v1/token

# Enterprise email sender (Phase 13)
# MMC_SENDER_EMAIL=reports@marshbrasil.com
# MMC_SENDER_NAME=BrasilIntel Reports
# MMC_EMAIL_PATH=/coreapi/email/v1
```

All MMC values are commented out (like existing patterns in the file) so the app works without them.
  </action>
  <verify>
Run `pip install tenacity>=8.0.0` to confirm the package installs cleanly. Grep requirements.txt for "tenacity" and .env.example for "MMC_API_BASE_URL" to confirm both sections are present.
  </verify>
  <done>tenacity is in requirements.txt. .env.example documents all MMC_API_* environment variables with staging host hint and commented-out defaults.</done>
</task>

</tasks>

<verification>
1. `python -c "from app.config import get_settings; s = get_settings(); assert hasattr(s, 'mmc_api_base_url'); assert hasattr(s, 'mmc_api_token_path'); assert s.is_mmc_auth_configured() == False; print('Config OK')"` prints "Config OK"
2. `pip install -r requirements.txt` succeeds without errors (tenacity installs)
3. .env.example contains "MMC_API_BASE_URL" section
</verification>

<success_criteria>
- Settings class has mmc_api_base_url, mmc_api_client_id, mmc_api_client_secret, mmc_api_key, mmc_api_token_path, mmc_sender_email, mmc_sender_name, mmc_email_path fields
- is_mmc_auth_configured(), is_mmc_api_key_configured(), is_mmc_email_configured() methods exist and return correct booleans
- tenacity>=8.0.0 listed in requirements.txt
- .env.example has documented MMC section with staging host hint
</success_criteria>

<output>
After completion, create `.planning/phases/09-enterprise-api-foundation/09-01-SUMMARY.md`
</output>
