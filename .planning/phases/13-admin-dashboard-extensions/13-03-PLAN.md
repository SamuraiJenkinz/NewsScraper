---
phase: 13-admin-dashboard-extensions
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - app/templates/report_professional.html
  - app/templates/report_basic.html
  - app/templates/alert_critical.html
autonomous: true

must_haves:
  truths:
    - "Article listings in reports show a 'Factiva' source badge next to articles collected from Factiva"
    - "Source badge is visually distinct (Dow Jones blue #0077c8 for Factiva) and displayed inline with article metadata"
    - "Non-Factiva articles show their source_name without a special badge (backward compatible)"
  artifacts:
    - path: "app/templates/report_professional.html"
      provides: "Factiva badge inline with source_name display"
      contains: "Factiva"
    - path: "app/templates/report_basic.html"
      provides: "Factiva badge inline with source_name display"
      contains: "Factiva"
    - path: "app/templates/alert_critical.html"
      provides: "Factiva badge inline with source_name display"
      contains: "Factiva"
  key_links:
    - from: "app/templates/report_professional.html"
      to: "app/models/news_item.py"
      via: "Template checks item.source_name == 'Factiva' for badge rendering"
      pattern: "source_name.*Factiva"
---

<objective>
Add Factiva source badges to article listings in BrasilIntel report templates.

Purpose: Admins viewing reports need to see at a glance which articles came from Factiva vs other sources. This satisfies ADMN-22 (article listings show source badge indicating Factiva attribution).

Output: Updated report templates with inline "Factiva" badges next to articles sourced from Factiva.
</objective>

<execution_context>
@C:\Users\taylo\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\taylo\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@C:\BrasilIntel\.planning\PROJECT.md
@C:\BrasilIntel\.planning\ROADMAP.md
@C:\BrasilIntel\.planning\STATE.md
@C:\BrasilIntel\.planning\phases\13-admin-dashboard-extensions\13-RESEARCH.md
@C:\BrasilIntel\.planning\phases\13-admin-dashboard-extensions\13-CONTEXT.md

Key existing files to read first:
@C:\BrasilIntel\app\templates\report_professional.html (main report template — source_name at line ~873)
@C:\BrasilIntel\app\templates\report_basic.html (basic report — source_name at line ~91)
@C:\BrasilIntel\app\templates\alert_critical.html (alert template — source_name at line ~99)
@C:\BrasilIntel\app\models\news_item.py (NewsItem model — source_name field)
@C:\BrasilIntel\app\collectors\factiva.py (sets source_name = "Factiva" via SOURCE_LABEL at line ~73)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Factiva source badges to all report templates</name>
  <files>app/templates/report_professional.html, app/templates/report_basic.html, app/templates/alert_critical.html</files>
  <action>
Read all three template files fully before making changes. Also read C:\BrasilIntel\app\collectors\factiva.py to confirm the SOURCE_LABEL value (should be "Factiva").

**IMPORTANT context for BrasilIntel reports:**
- BrasilIntel uses `source_name` field on NewsItem (NOT `collector_source` like MDInsights)
- The FactivaCollector sets `source_name = "Factiva"` (via SOURCE_LABEL class constant)
- Legacy Apify sources set various source_name values like "Google News", "Valor Economico", etc.
- Reports are rendered as HTML for BOTH browser viewing AND email delivery
- ALL styles must be INLINE (no classes or external CSS) for email compatibility (Outlook, Gmail)
- BrasilIntel reports are in Portuguese ("Fonte:" prefix for source name)

**For each template, find where source_name is displayed and enhance it:**

**1. report_professional.html** (line ~873):
Current: `{% if item.source_name %} | Fonte: {{ item.source_name }}{% endif %}`

Replace with:
```html
{% if item.source_name %}
 | Fonte:
{% if item.source_name == 'Factiva' %}
<span style="display: inline-block; background-color: #0077c8; color: white; padding: 1px 6px; border-radius: 3px; font-size: 0.75em; font-weight: 600; vertical-align: middle;">Factiva</span>
{% else %}
{{ item.source_name }}
{% endif %}
{% endif %}
```

**2. report_basic.html** (line ~91):
Current: `{% if item.source_name %}Fonte: {{ item.source_name }}{% endif %}`

Apply the same Factiva badge pattern with inline styles.

**3. alert_critical.html** (line ~99):
Current: `{% if item.source_name %}Fonte: {{ item.source_name }}{% endif %}`

Apply the same Factiva badge pattern with inline styles.

**Badge design rationale:**
- Background: #0077c8 (Dow Jones brand blue — consistent with MDInsights Factiva badge)
- Color: white text on blue background
- Font-size: 0.75em (small pill, subordinate to article title)
- Border-radius: 3px (rounded pill shape)
- ALL inline styles (no CSS classes) because these templates render for email
- Non-Factiva articles display source_name as plain text (no badge) — backward compatible
  </action>
  <verify>
1. Grep for `#0077c8` in report_professional.html to confirm Factiva badge color added
2. Grep for `#0077c8` in report_basic.html to confirm badge added
3. Grep for `#0077c8` in alert_critical.html to confirm badge added
4. Grep for `source_name == 'Factiva'` across all three templates to confirm conditional logic
5. Verify no CSS class references are used in the badge (only inline styles) — grep for `class=.*factiva` should return nothing
  </verify>
  <done>
All three report templates (professional, basic, critical alert) display a Factiva badge (blue #0077c8 inline-styled pill) next to articles where source_name == "Factiva". Non-Factiva articles display their source_name as plain text. All styles are inline for email compatibility. Badge is visually consistent with MDInsights Factiva branding.
  </done>
</task>

</tasks>

<verification>
1. All three report templates contain Factiva badge with inline styles
2. Badge uses #0077c8 (Dow Jones blue) background
3. Conditional check is source_name == 'Factiva'
4. Non-Factiva articles render source_name as plain text (backward compatible)
5. No CSS class references in badge (email compatibility)
</verification>

<success_criteria>
- ADMN-22 satisfied: Article listings show "Factiva" source badge on articles collected from Factiva
- Badge is visually distinct with Dow Jones blue branding
- Email-compatible inline styles (no CSS classes)
- Backward compatible — non-Factiva articles show source name as plain text
</success_criteria>

<output>
After completion, create `.planning/phases/13-admin-dashboard-extensions/13-03-SUMMARY.md`
</output>
